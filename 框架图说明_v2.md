# Risk-MAS æ¡†æ¶å›¾è¯´æ˜

## æ•´ä½“æµç¨‹

```
è¾“å…¥ â†’ 1.çŠ¶æ€æ¨¡å— â†’ 2.è¾“å…¥è§„èŒƒåŒ– â†’ 3.æ•°æ®ä¸æŒ‡æ ‡æ¨¡å— â†’ 4.ç¼–æ’æ¨¡å— â†’ 5/6.å¹¶è¡Œåˆ†æ â†’ 7.æ±‡æ€»ä¸å†³ç­– â†’ è¾“å‡º
```

---

## æ¶æ„è®¾è®¡åŸåˆ™

### 1. èŒè´£åˆ†ç¦»ï¼ˆSeparation of Concernsï¼‰
- **Gatekeeper**ï¼šæ•°æ®å¯ç”¨æ€§æ£€æŸ¥ â†’ å›ç­”"å“ªäº›èŠ‚ç‚¹**å¯ä»¥**è¿è¡Œ"
- **Supervisor**ï¼šä¸šåŠ¡é€»è¾‘é€‰æ‹© â†’ å›ç­”"å“ªäº›èŠ‚ç‚¹**éœ€è¦**è¿è¡Œ"
- é¿å…é‡å¤åˆ¤æ–­ï¼Œå•ä¸€æ•°æ®æº

### 2. ä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼‰
- `RuntimeConfig` å¯¹è±¡æ³¨å…¥åˆ°å…³é”®æ¨¡å—ï¼ˆsupervisor, agentsï¼‰
- æ˜¾å¼ä¾èµ–ï¼Œæ˜“äºæµ‹è¯•å’Œç»´æŠ¤
- é¿å…éšå¼çš„ `os.getenv()` è°ƒç”¨

### 3. æ˜¾å¼çŠ¶æ€ç®¡ç†ï¼ˆExplicit Stateï¼‰
- ä½¿ç”¨ `TypedDict` å®šä¹‰ `RiskState`
- ç±»å‹å®‰å…¨ï¼Œå¯è¿½æº¯
- æ‰€æœ‰èŠ‚ç‚¹é€šè¿‡ state ä¼ é€’æ•°æ®

### 4. å¹¶è¡Œæ‰§è¡Œï¼ˆParallel Executionï¼‰
- ä½¿ç”¨ LangGraph `Send API` å®ç°çœŸæ­£çš„å¹¶è¡Œ
- 6 ä¸ªåˆ†æèŠ‚ç‚¹å¹¶å‘æ‰§è¡Œ
- æå‡å¤„ç†æ•ˆç‡

---

## æ¨¡å—è¯¦ç»†è¯´æ˜

### 1. çŠ¶æ€æ¨¡å—
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   state.py      â”‚
â”‚  (æ˜¾å¼Stateå®šä¹‰) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. è¾“å…¥è§„èŒƒåŒ–æ¨¡å—
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  validate.py    â”‚
â”‚ (æ ¡éªŒä¸å½’ä¸€åŒ–)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. æ•°æ®ä¸æŒ‡æ ‡æ¨¡å—
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  csv_data.py    â”‚ data_quality.py â”‚  snapshot.py    â”‚
â”‚   (æ•°æ®è¯»å–)     â”‚  (æ•°æ®è´¨é‡æ£€æŸ¥)   â”‚   (æŒ‡æ ‡å¿«ç…§)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚      utils.py       â”‚  
               â”‚ (å…±äº«å·¥å…·å‡½æ•°)        â”‚
               â”‚ normalize_weights   â”‚
               â”‚ compute_hhi         â”‚
               â”‚ compute_effective_n â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. ç¼–æ’æ¨¡å—
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    graph.py                         â”‚
â”‚              (æµç¨‹ç¼–æ’ä¸å¹¶è¡Œè°ƒåº¦)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ gatekeeper.py   â”‚â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ (æ•°æ®å¯ç”¨æ€§æ£€æŸ¥)  â”‚       â”‚
â”‚ (å€™é€‰èŠ‚ç‚¹ç­›é€‰)    â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
                          â”‚  
                          â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ supervisor.py   â”‚
                  â”‚ (ä¸šåŠ¡é€»è¾‘é€‰æ‹©)    â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ Send API (å¹¶è¡Œåˆ†å‘)
                           â–¼
```

### 5. åˆ†æé“¾è·¯æ¨¡å— + 6. Agentæ¨¡å—ï¼ˆå¹¶è¡Œæ‰§è¡Œï¼‰
```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚           å¹¶è¡Œæ‰§è¡ŒåŒºåŸŸ                    â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
                    â”‚  â”‚ market.py   â”‚  â”‚concentrationâ”‚       â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â†’â”‚  (å¸‚åœºé£é™©)  â”‚  â”‚   .py       â”‚â†â”€â”€â”€â”€â”€â”€â”¼â”€â”
          â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  (é›†ä¸­åº¦)    â”‚       â”‚ â”‚
          â”‚         â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â”‚
supervisorâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â†â”€â”€â”€â”€â”€â”€â”¼â”€â”¤
          â”‚         â”‚  â”‚diversific-  â”‚  â”‚liquidity.py â”‚       â”‚ â”‚
          â”‚         â”‚  â”‚  ation.py   â”‚  â”‚  (æµåŠ¨æ€§)    â”‚       â”‚ â”‚
          â”‚         â”‚  â”‚  (åˆ†æ•£åº¦)    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â”‚
          â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚ â”‚
          â”‚         â”‚                                         â”‚ â”‚
          â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â†’â”‚macro_agent  â”‚  â”‚compliance_  â”‚â†â”€â”€â”€â”€â”€â”€â”¼â”€â”˜
                    â”‚  â”‚    .py      â”‚  â”‚  agent.py   â”‚       â”‚
                    â”‚  â”‚ å®è§‚Agent    â”‚  â”‚  åˆè§„Agent  â”‚       â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
                    â”‚                                         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â”‚ å…¨éƒ¨æ±‡èš
                                      â–¼
```

### 7. æ±‡æ€»ä¸å†³ç­–æ¨¡å—
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   reducer.py    â”‚
â”‚ (é£é™©æ±‡æ€»è¾“å‡º)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  decision.py    â”‚â”€â”€â”€â”€â†’â”‚   solver.py     â”‚ (restrictæ—¶è§¦å‘)
â”‚   (å†³ç­–å¼•æ“)     â”‚     â”‚  (çº¦æŸæ±‚è§£)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€ pass â”€â”€â†’ æ”¾è¡Œ
         â”œâ”€â”€ warn â”€â”€â†’ é¢„è­¦
         â”œâ”€â”€ restrict â†’ é™åˆ¶ + è°ƒä»“å»ºè®®
         â””â”€â”€ block â”€â”€â†’ é˜»æ–­
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    audit.py     â”‚
â”‚  (å®¡è®¡ä¸è¿½æº¯)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
       å®Œæˆ
```

---

## Skills æ¨¡å—
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   skills_runtime.py                 â”‚
â”‚              (è¯»å–SKILL/Schema/å·¥å…·ç™½åå•)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  skills/                                                       â”‚
â”‚  â”œâ”€â”€ macro-tool-calling/                                       â”‚
â”‚  â”‚   â”œâ”€â”€ SKILL.md              (æŠ€èƒ½å®šä¹‰)                       â”‚
â”‚  â”‚   â””â”€â”€ output.schema.json    (è¾“å‡ºç»“æ„)                       â”‚
â”‚  â”œâ”€â”€ compliance-tool-calling/                                  â”‚
â”‚  â”‚   â”œâ”€â”€ SKILL.md                                              â”‚
â”‚  â”‚   â””â”€â”€ output.schema.json                                    â”‚
â”‚  â”œâ”€â”€ snippets/                                                 â”‚
â”‚  â”‚   â”œâ”€â”€ evidence_rules.md     (è¯æ®è§„èŒƒ)                       â”‚
â”‚  â”‚   â””â”€â”€ decision_rubric.md    (å†³ç­–æ ‡å‡†)                       â”‚
â”‚  â””â”€â”€ tools/                                                    â”‚
â”‚      â””â”€â”€ tool_interfaces.yaml  (å·¥å…·æ³¨å†Œè¡¨)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## é…ç½®æ¨¡å—
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              config.py                          â”‚
â”‚                       RuntimeConfig (dataclass)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç‰¹æ€§ï¼š                                                           â”‚
â”‚ â€¢ @dataclass(frozen=True) - ä¸å¯å˜é…ç½®å¯¹è±¡                        â”‚
â”‚ â€¢ from_env() - ç»Ÿä¸€è¯»å–ç¯å¢ƒå˜é‡                                   â”‚
â”‚ â€¢ ç±»å‹å®‰å…¨è¾…åŠ©å‡½æ•°ï¼ˆ_env_int / _env_float / _env_boolï¼‰            â”‚
â”‚ â€¢ å‘åå…¼å®¹åˆ«åï¼šConfig = RuntimeConfig                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é…ç½®åˆ†ç±»ï¼š                                                        â”‚
â”‚ ğŸ“Š æ•°æ®ä¸é‡‡æ ·ï¼š                                                   â”‚
â”‚    â€¢ csv_data_dir / sample_universe_size / random_seed          â”‚
â”‚    â€¢ market_lookback_days / asof_date                           â”‚
â”‚ ğŸŒ å®è§‚æ•°æ®ï¼š                                                     â”‚
â”‚    â€¢ tushare_token / macro_series_config                        â”‚
â”‚    â€¢ macro_stale_days / macro_severity_weight                   â”‚
â”‚ ğŸ“‹ åˆè§„ä¸ RAGï¼š                                                   â”‚
â”‚    â€¢ compliance_rag_source / rag_engine                         â”‚
â”‚ ğŸ¤– LLM é…ç½®ï¼š                                                    â”‚
â”‚    â€¢ llm_model / openai_api_key / openai_base_url               â”‚
â”‚    â€¢ enable_supervisor                                          â”‚
â”‚ ğŸ’¼ ç»„åˆä¸æ±‚è§£å™¨ï¼š                                                  â”‚
â”‚    â€¢ default_aum / target_holdings / cash_symbol                â”‚
â”‚    â€¢ lp_turnover_weight / lp_solver                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä½¿ç”¨æ–¹å¼ï¼š                                                        â”‚
â”‚ # åˆ›å»ºé…ç½®å®ä¾‹                                                    â”‚
â”‚ config = RuntimeConfig.from_env()                               â”‚
â”‚ # ä¾èµ–æ³¨å…¥åˆ°å…³é”®æ¨¡å—                                               â”‚
â”‚ supervisor_chain(state, llm, candidates, config)                â”‚
â”‚ run_macro_agent(state, llm, config)                             â”‚
â”‚ constraint_solver(state, config)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Tools æ¨¡å—æ±‡æ€»
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            tools/                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ utils.py                 å…±äº«å·¥å…·å‡½æ•°                          â”‚
â”‚ validate.py              è¾“å…¥æ ¡éªŒä¸å½’ä¸€åŒ–                       â”‚
â”‚ csv_data.py              CSVæ•°æ®è¯»å–                          â”‚
â”‚ data_quality.py          æ•°æ®è´¨é‡æ£€æŸ¥                          â”‚
â”‚ snapshot.py              æŒ‡æ ‡å¿«ç…§è®¡ç®—                          â”‚
â”‚ constraints.py           è§„åˆ™è¯„ä¼°ä¸ç¡¬çº¦æŸ                       â”‚
â”‚ decision.py              å†³ç­–å¼•æ“                             â”‚
â”‚ solver.py                çº¦æŸæ±‚è§£ï¼ˆcvxpyï¼‰                     â”‚
â”‚ rules.py                 è§„åˆ™åŠ è½½                             â”‚
â”‚ audit.py                 å®¡è®¡è¾“å‡º                             â”‚
â”‚ calibrate_rules.py       è§„åˆ™é˜ˆå€¼æ ¡å‡†                          â”‚
â”‚ calibrate_macro_series.py å®è§‚åºåˆ—é˜ˆå€¼æ ¡å‡†                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ•°æ®æµå›¾

### State æµè½¬æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         RiskState (TypedDict)                   â”‚
â”‚                    è´¯ç©¿æ•´ä¸ªå·¥ä½œæµçš„æ˜¾å¼çŠ¶æ€                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  INPUT: intent + context                                        â”‚
â”‚  â”œâ”€ intent: {date, mode, targets}                               â”‚
â”‚  â””â”€ context: {current_positions, policy_profile, aum, ...}      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VALIDATE: æ ¡éªŒä¸å½’ä¸€åŒ–                                           â”‚
â”‚  OUTPUT: normalized (å½’ä¸€åŒ–åçš„è¾“å…¥)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DATA_QUALITY: æ•°æ®è´¨é‡æ£€æŸ¥                                       â”‚
â”‚  OUTPUT: data_quality {market, macro, compliance, positions}    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SNAPSHOT: æŒ‡æ ‡å¿«ç…§è®¡ç®—                                           â”‚
â”‚  OUTPUT: snapshot_metrics {portfolio_volatility, hhi, ...}      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GATEKEEPER: æ•°æ®å¯ç”¨æ€§æ£€æŸ¥                                       â”‚
â”‚  OUTPUT: candidate_nodes (å¯è¿è¡Œçš„èŠ‚ç‚¹åˆ—è¡¨)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SUPERVISOR: ä¸šåŠ¡é€»è¾‘é€‰æ‹©                                         â”‚
â”‚  INPUT: candidate_nodes, snapshot_metrics, rule_findings        â”‚
â”‚  OUTPUT: nodes_to_run, pending_agents (éœ€è¦è¿è¡Œçš„èŠ‚ç‚¹)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼ (Send API å¹¶è¡Œåˆ†å‘)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PARALLEL ANALYSIS: 6ä¸ªèŠ‚ç‚¹å¹¶å‘æ‰§è¡Œ                               â”‚
â”‚  â”œâ”€ market        â†’ finding_market                              â”‚
â”‚  â”œâ”€ concentration â†’ finding_concentration                       â”‚
â”‚  â”œâ”€ diversification â†’ finding_diversification                   â”‚
â”‚  â”œâ”€ liquidity     â†’ finding_liquidity                           â”‚
â”‚  â”œâ”€ macro         â†’ finding_macro + tool_calls_macro            â”‚
â”‚  â””â”€ compliance    â†’ finding_compliance + tool_calls_compliance  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ (å…¨éƒ¨æ±‡èš)
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  REDUCER: æ±‡æ€»æ‰€æœ‰ findings                                      â”‚
â”‚  OUTPUT: risk_summary (æ±‡æ€»çš„é£é™©æŠ¥å‘Š)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CONSTRAINTS: çº¦æŸè¯„ä¼°                                           â”‚
â”‚  OUTPUT: rule_findings, binding_constraints                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DECISION: å†³ç­–å¼•æ“                                              â”‚
â”‚  OUTPUT: decision {decision, recommendation, ...}               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SOLVER: çº¦æŸæ±‚è§£ (ä»…åœ¨ restrict æ—¶è§¦å‘)                           â”‚
â”‚  OUTPUT: recommended_actions (è°ƒä»“å»ºè®®)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AUDIT: å®¡è®¡æ—¥å¿—                                                 â”‚
â”‚  OUTPUT: audit (å®Œæ•´çš„å®¡è®¡è¿½è¸ª)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                    æœ€ç»ˆè¾“å‡º
```

---

## æ¨¡å—é—´äº¤äº’è¯´æ˜

### 1. è¾“å…¥å±‚ â†’ é¢„å¤„ç†ç®¡é“

**Validate (è¾“å…¥éªŒè¯)**
- **è¾“å…¥**: `intent`, `context`
- **è¾“å‡º**: `normalized`, `validation`
- **ä½œç”¨**: æ ¡éªŒè¾“å…¥æ ¼å¼ï¼Œå½’ä¸€åŒ–æƒé‡ï¼Œè®¡ç®— asof_date
- **ä¾èµ–**: æ— 

**Data Quality (æ•°æ®è´¨é‡æ£€æŸ¥)**
- **è¾“å…¥**: `normalized`
- **è¾“å‡º**: `data_quality`
- **ä½œç”¨**: æ£€æŸ¥å¸‚åœºæ•°æ®ã€å®è§‚æ•°æ®ã€åˆè§„æ•°æ®çš„å¯ç”¨æ€§å’Œæ–°é²œåº¦
- **ä¾èµ–**: CSV æ•°æ®æ–‡ä»¶ã€Tushare APIï¼ˆå¯é€‰ï¼‰

**Snapshot (æŒ‡æ ‡å¿«ç…§)**
- **è¾“å…¥**: `normalized`, `data_quality`
- **è¾“å‡º**: `snapshot_metrics`
- **ä½œç”¨**: è®¡ç®—ç»„åˆæŒ‡æ ‡ï¼ˆæ³¢åŠ¨ç‡ã€HHIã€æµåŠ¨æ€§ç­‰ï¼‰
- **ä¾èµ–**: å¸‚åœºæ•°æ®

---

### 2. ç¼–æ’å±‚

**Gatekeeper (é—¨æ§)**
- **è¾“å…¥**: `data_quality`
- **è¾“å‡º**: `candidate_nodes`
- **ä½œç”¨**: åŸºäºæ•°æ®å¯ç”¨æ€§ç­›é€‰å€™é€‰èŠ‚ç‚¹
- **è§„åˆ™**:
  - å¦‚æœ `timeseries_available=False`ï¼Œåˆ™ macro ä¸è¿›å…¥å€™é€‰
  - å¦‚æœ `text_available=False`ï¼Œåˆ™ compliance ä¸è¿›å…¥å€™é€‰
  - å…¶ä»–èŠ‚ç‚¹é»˜è®¤è¿›å…¥å€™é€‰

**Supervisor (è°ƒåº¦å™¨)**
- **è¾“å…¥**: `candidate_nodes`, `snapshot_metrics`, `rule_findings`, `data_quality`
- **è¾“å‡º**: `nodes_to_run`, `pending_agents`, `supervisor_rationale`
- **ä½œç”¨**: åŸºäºä¸šåŠ¡é€»è¾‘ä»å€™é€‰èŠ‚ç‚¹ä¸­é€‰æ‹©éœ€è¦è¿è¡Œçš„èŠ‚ç‚¹
- **ä¾èµ–**: LLMï¼ˆå¯é€‰ï¼Œä¸å¯ç”¨æ—¶å›é€€åˆ°è¿è¡Œæ‰€æœ‰å€™é€‰èŠ‚ç‚¹ï¼‰
- **æ³¨å…¥**: `RuntimeConfig` å¯¹è±¡

---

### 3. å¹¶è¡Œåˆ†æå±‚

**ç¡®å®šæ€§é“¾è·¯èŠ‚ç‚¹** (market, concentration, diversification, liquidity)
- **è¾“å…¥**: `snapshot_metrics`, `normalized`
- **è¾“å‡º**: `finding_<name>` (åŒ…å« severity, summary, metrics)
- **æ‰§è¡Œæ¡ä»¶**: åœ¨ `pending_agents` åˆ—è¡¨ä¸­
- **ç‰¹ç‚¹**: æ—  LLM è°ƒç”¨ï¼Œçº¯è®¡ç®—é€»è¾‘

**Agent èŠ‚ç‚¹** (macro, compliance)
- **è¾“å…¥**: `snapshot_metrics`, `normalized`, `data_quality`
- **è¾“å‡º**: `finding_<name>`, `tool_calls_<name>`
- **æ‰§è¡Œæ¡ä»¶**: åœ¨ `pending_agents` åˆ—è¡¨ä¸­
- **ç‰¹ç‚¹**: ä½¿ç”¨ LLM + å·¥å…·è°ƒç”¨
- **ä¾èµ–**: LLM, Tushare API (macro), RAG (compliance)
- **æ³¨å…¥**: `RuntimeConfig` å¯¹è±¡

**å¹¶è¡Œæœºåˆ¶**:
- ä½¿ç”¨ LangGraph `Send API`
- Supervisor è¿”å› `List[Send]`
- æ‰€æœ‰èŠ‚ç‚¹çœŸæ­£å¹¶å‘æ‰§è¡Œ
- å…¨éƒ¨å®Œæˆåæ±‡èšåˆ° Reducer

---

### 4. åå¤„ç†ç®¡é“

**Reducer (æ±‡æ€»)**
- **è¾“å…¥**: æ‰€æœ‰ `finding_*` å­—æ®µ
- **è¾“å‡º**: `risk_summary`
- **ä½œç”¨**: æ±‡æ€»æ‰€æœ‰é£é™©å‘ç°ï¼Œè®¡ç®—æœ€é«˜ severity

**Constraints (çº¦æŸè¯„ä¼°)**
- **è¾“å…¥**: `snapshot_metrics`, `normalized`
- **è¾“å‡º**: `rule_findings`, `binding_constraints`
- **ä½œç”¨**: è¯„ä¼°ç¡¬è§„åˆ™çº¦æŸï¼ˆHHIã€æ³¢åŠ¨ç‡ã€æµåŠ¨æ€§ç­‰ï¼‰
- **ä¾èµ–**: `rules.yaml` é…ç½®æ–‡ä»¶

**Decision (å†³ç­–å¼•æ“)**
- **è¾“å…¥**: `risk_summary`, `rule_findings`, `binding_constraints`
- **è¾“å‡º**: `decision` (pass/warn/restrict/block)
- **ä½œç”¨**: ç»¼åˆé£é™©æŠ¥å‘Šå’Œè§„åˆ™çº¦æŸï¼Œåšå‡ºæœ€ç»ˆå†³ç­–
- **è§„åˆ™**:
  - ç¡¬è§„åˆ™ä¼˜å…ˆï¼ˆrule_levelï¼‰
  - é£é™©æŠ¥å‘Šå…œåº•ï¼ˆreport_levelï¼‰

**Solver (çº¦æŸæ±‚è§£)**
- **è¾“å…¥**: `normalized`, `binding_constraints`, `snapshot_metrics`
- **è¾“å‡º**: `recommended_actions`
- **ä½œç”¨**: ä½¿ç”¨ CVXPY ç”Ÿæˆæ»¡è¶³çº¦æŸçš„è°ƒä»“å»ºè®®
- **è§¦å‘æ¡ä»¶**: ä»…åœ¨ `decision=restrict` æ—¶è¿è¡Œ
- **æ³¨å…¥**: `RuntimeConfig` å¯¹è±¡

**Audit (å®¡è®¡)**
- **è¾“å…¥**: æ•´ä¸ª `RiskState`
- **è¾“å‡º**: `audit`
- **ä½œç”¨**: ç”Ÿæˆå®Œæ•´çš„å®¡è®¡è¿½è¸ªï¼ŒåŒ…å«æ‰€æœ‰å†³ç­–ä¾æ®
- **æ³¨å…¥**: `RuntimeConfig` å¯¹è±¡

---

### 5. æ•°æ®ä¼ é€’æ–¹å¼

**æ˜¾å¼ State ç®¡ç†**:
- æ‰€æœ‰æ•°æ®é€šè¿‡ `RiskState` (TypedDict) ä¼ é€’
- æ¯ä¸ªèŠ‚ç‚¹è¿”å› `Dict[str, Any]`ï¼Œè‡ªåŠ¨åˆå¹¶åˆ° State
- ç±»å‹å®‰å…¨ï¼Œå¯è¿½æº¯

**é…ç½®æ³¨å…¥**:
- `RuntimeConfig` å¯¹è±¡é€šè¿‡å‡½æ•°å‚æ•°æ³¨å…¥
- é¿å…éšå¼çš„ `os.getenv()` è°ƒç”¨
- æ˜“äºæµ‹è¯•å’Œ mock

**å¹¶è¡Œå®‰å…¨**:
- æ¯ä¸ªå¹¶è¡ŒèŠ‚ç‚¹æ¥æ”¶ç‹¬ç«‹çš„ State å‰¯æœ¬
- èŠ‚ç‚¹é—´æ— å…±äº«çŠ¶æ€
- é€šè¿‡ Reducer æ±‡èšç»“æœ

---
