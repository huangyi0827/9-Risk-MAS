<div align="center">

# ğŸ›¡ï¸ Risk-MAS

**åŸºäºå¤šæ™ºèƒ½ä½“ç³»ç»Ÿçš„ ETF æŠ•èµ„ç»„åˆé£æ§æ¡†æ¶**

[![Python](https://img.shields.io/badge/Python-3.12+-blue.svg)](https://www.python.org/)
[![LangGraph](https://img.shields.io/badge/LangGraph-1.0+-green.svg)](https://github.com/langchain-ai/langgraph)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

*åŸºäº LangChainã€LangGraph æ„å»ºçš„ ETF é£æ§å¤šæ™ºèƒ½ä½“ç³»ç»Ÿï¼ˆMASï¼‰ï¼Œè¦†ç›–è¾“å…¥è§„èŒƒåŒ–ã€æŒ‡æ ‡å¿«ç…§ã€ç¼–æ’è°ƒåº¦ä¸ç»“è®ºè¾“å‡ºï¼Œæ”¯æŒæ¥å…¥å®è§‚æ—¶åºä¸æ”¿ç­–ã€åˆè§„æ–‡æœ¬æ•°æ®ï¼Œäº§å‡ºå¯å®¡è®¡çš„é£é™©ç»“è®ºä¸è°ƒä»“å»ºè®®ã€‚*

</div>

---

## ğŸ“‘ ç›®å½•ç´¢å¼•

- [ğŸ›¡ï¸ Risk-MAS](#ï¸-risk-mas)
  - [ğŸ“‘ ç›®å½•ç´¢å¼•](#-ç›®å½•ç´¢å¼•)
  - [ğŸ“– é¡¹ç›®ç®€ä»‹](#-é¡¹ç›®ç®€ä»‹)
    - [è®¾è®¡ç†å¿µ](#è®¾è®¡ç†å¿µ)
  - [âœ¨ æ ¸å¿ƒç‰¹æ€§](#-æ ¸å¿ƒç‰¹æ€§)
  - [ğŸ—ï¸ ç³»ç»Ÿæ¶æ„](#ï¸-ç³»ç»Ÿæ¶æ„)
    - [æ¶æ„æ¦‚è§ˆ](#æ¶æ„æ¦‚è§ˆ)
    - [å·¥ä½œæµç¨‹](#å·¥ä½œæµç¨‹)
    - [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
      - [åˆ†æèŠ‚ç‚¹è¯´æ˜](#åˆ†æèŠ‚ç‚¹è¯´æ˜)
      - [å†³ç­–ç­‰çº§](#å†³ç­–ç­‰çº§)
  - [ğŸš€ å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)
    - [ç¯å¢ƒè¦æ±‚](#ç¯å¢ƒè¦æ±‚)
    - [å®‰è£…æ­¥éª¤](#å®‰è£…æ­¥éª¤)
    - [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
    - [è¿è¡Œæ–¹å¼](#è¿è¡Œæ–¹å¼)
  - [ğŸ“˜ ä½¿ç”¨æŒ‡å—](#-ä½¿ç”¨æŒ‡å—)
    - [API è°ƒç”¨](#api-è°ƒç”¨)
    - [è¾“å…¥å‚æ•°](#è¾“å…¥å‚æ•°)
      - [Intentï¼ˆäº¤æ˜“æ„å›¾ï¼‰](#intentäº¤æ˜“æ„å›¾)
      - [Contextï¼ˆç»„åˆä¸Šä¸‹æ–‡ï¼‰](#contextç»„åˆä¸Šä¸‹æ–‡)
      - [RiskMAS æ„é€ å‚æ•°](#riskmas-æ„é€ å‚æ•°)
    - [è¾“å‡ºç¤ºä¾‹](#è¾“å‡ºç¤ºä¾‹)
  - [âš™ï¸ é…ç½®è¯¦è§£](#ï¸-é…ç½®è¯¦è§£)
    - [asof\_date å–å€¼è§„åˆ™](#asof_date-å–å€¼è§„åˆ™)
    - [ç¯å¢ƒå˜é‡](#ç¯å¢ƒå˜é‡)
      - [æ•°æ®ä¸é‡‡æ ·](#æ•°æ®ä¸é‡‡æ ·)
      - [å®è§‚æ—¶åº](#å®è§‚æ—¶åº)
      - [åˆè§„æ–‡æœ¬ / RAG](#åˆè§„æ–‡æœ¬--rag)
      - [ç»„åˆæ‰§è¡Œä¸ LP](#ç»„åˆæ‰§è¡Œä¸-lp)
    - [è§„åˆ™é˜ˆå€¼](#è§„åˆ™é˜ˆå€¼)
      - [rules.yamlï¼ˆç»„åˆè§„åˆ™é˜ˆå€¼ï¼‰](#rulesyamlç»„åˆè§„åˆ™é˜ˆå€¼)
      - [macro\_series.yamlï¼ˆå®è§‚é˜ˆå€¼é…ç½®ï¼‰](#macro_seriesyamlå®è§‚é˜ˆå€¼é…ç½®)
    - [Skills ä½“ç³»](#skills-ä½“ç³»)
  - [ğŸ“ é¡¹ç›®ç»“æ„](#-é¡¹ç›®ç»“æ„)
  - [ğŸ”„ è¿ç§»æŒ‡å—](#-è¿ç§»æŒ‡å—)
    - [1. æ•°æ®æºä¸å­—æ®µå¯¹é½](#1-æ•°æ®æºä¸å­—æ®µå¯¹é½)
    - [2. é˜ˆå€¼ä¸æ ¡å‡†](#2-é˜ˆå€¼ä¸æ ¡å‡†)
    - [3. Skills ä¸å·¥å…·æƒé™](#3-skills-ä¸å·¥å…·æƒé™)
    - [4. å®¡è®¡ä¸è¾“å‡º](#4-å®¡è®¡ä¸è¾“å‡º)
  - [â“ å¸¸è§é—®é¢˜](#-å¸¸è§é—®é¢˜)

---

## ğŸ“– é¡¹ç›®ç®€ä»‹

Risk-MAS æ˜¯ä¸€ä¸ªä¸“ä¸º ETF æŠ•èµ„ç»„åˆè®¾è®¡çš„æ™ºèƒ½é£æ§ç³»ç»Ÿï¼Œé‡‡ç”¨å¤šæ™ºèƒ½ä½“æ¶æ„ï¼ˆMulti-Agent Systemï¼‰ï¼Œå°†å¤æ‚çš„é£æ§ä»»åŠ¡åˆ†è§£ä¸ºå¤šä¸ªä¸“ä¸šåŒ–çš„åˆ†ææ¨¡å—ï¼Œé€šè¿‡ LangGraph å®ç°é«˜æ•ˆçš„å¹¶è¡Œæ‰§è¡Œä¸æ™ºèƒ½è°ƒåº¦ã€‚

### è®¾è®¡ç†å¿µ

| ç†å¿µ | è¯´æ˜ |
|:---:|:---|
| **ç¡®å®šæ€§ä¼˜å…ˆ** | ç¡¬è§„åˆ™æ£€æŸ¥ä¼˜å…ˆäº LLM åˆ¤æ–­ï¼Œç¡®ä¿å…³é”®é£æ§é€»è¾‘çš„å¯é æ€§ |
| **å¹¶è¡Œé«˜æ•ˆ** | 6 ä¸ªåˆ†æèŠ‚ç‚¹çœŸæ­£å¹¶è¡Œæ‰§è¡Œï¼Œå¤§å¹…æå‡å¤„ç†æ•ˆç‡ |
| **å¯å®¡è®¡è¿½æº¯** | å®Œæ•´çš„å®¡è®¡æ—¥å¿—ï¼Œæ‰€æœ‰å†³ç­–éƒ½æœ‰æ®å¯æŸ¥ |
| **çµæ´»å¯é…** | Skills ä½“ç³»æ”¯æŒæç¤ºè¯ã€è¾“å‡ºç»“æ„çš„çƒ­é…ç½® |

---

## ğŸ“ å­¦ä¹ è·¯å¾„

**æœ¬é¡¹ç›®å®šä½ä¸º MAS æ•™å­¦é¡¹ç›®**ï¼Œæä¾›å®Œæ•´çš„å­¦ä¹ èµ„æºï¼š

| èµ„æº | è¯´æ˜ | é€‚åˆäººç¾¤ |
|:---:|:---|:---|
| **ğŸ“˜ [PRACTICE.md](PRACTICE.md)** | 10ä¸ªæ¨¡å—çš„å®æˆ˜ç»ƒä¹ ï¼ŒåŒ…å«ä»£ç æ¨¡æ¿å’Œæµ‹è¯•æ£€æŸ¥ | å­¦ä¹ è€…ï¼šé€šè¿‡å®è·µæŒæ¡ MAS æ¶æ„ |
| **ğŸ“ [æ¡†æ¶å›¾è¯´æ˜_v2.md](æ¡†æ¶å›¾è¯´æ˜_v2.md)** | è¯¦ç»†çš„æ¶æ„æ–‡æ¡£ï¼ŒåŒ…å«æ•°æ®æµå›¾å’Œæ¨¡å—äº¤äº’è¯´æ˜ | å¼€å‘è€…ï¼šæ·±å…¥ç†è§£ç³»ç»Ÿè®¾è®¡ |
| **ğŸ“– README.md** | å¿«é€Ÿå…¥é—¨å’Œä½¿ç”¨æŒ‡å— | ç”¨æˆ·ï¼šå¿«é€Ÿä¸Šæ‰‹ä½¿ç”¨ç³»ç»Ÿ |

> ğŸ’¡ **æ¨èå­¦ä¹ è·¯å¾„**ï¼šå…ˆé˜…è¯» README äº†è§£ç³»ç»Ÿ â†’ æŸ¥çœ‹æ¡†æ¶å›¾è¯´æ˜ç†è§£æ¶æ„ â†’ ä½¿ç”¨ PRACTICE.md åŠ¨æ‰‹å®è·µ

---

## âœ¨ æ ¸å¿ƒç‰¹æ€§

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Risk-MAS æ ¸å¿ƒç‰¹æ€§                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ”„ å¹¶è¡Œæ‰§è¡Œ      åŸºäº LangGraph Send API å®ç° 6 èŠ‚ç‚¹çœŸæ­£å¹¶è¡Œ        â”‚
â”‚  ğŸ“Š æ˜¾å¼çŠ¶æ€      TypedDict å®šä¹‰çš„ RiskStateï¼Œç±»å‹å®‰å…¨å¯è¿½æº¯         â”‚
â”‚  ğŸ”— æ··åˆæ¶æ„      4 æ¡ç¡®å®šæ€§é“¾ + 2 ä¸ª LLM æ™ºèƒ½ä»£ç†                   â”‚
â”‚  ğŸ› ï¸ å·¥å…·ç™½åå•    ä¸¥æ ¼æ§åˆ¶ LLM å¯è°ƒç”¨çš„å·¥å…·èŒƒå›´ï¼Œçº¿ç¨‹å®‰å…¨               â”‚
â”‚  âš–ï¸ æ™ºèƒ½å†³ç­–      ç¡¬è§„åˆ™ä¼˜å…ˆ + é£é™©æŠ¥å‘Šå…œåº•ï¼Œè¾“å‡ºè°ƒä»“å»ºè®®               â”‚
â”‚  ğŸ“ Skills ä½“ç³»   æç¤ºè¯/è¾“å‡ºç»“æ„/è¯æ®è§„åˆ™å¯é…ç½®åŒ–                    â”‚
â”‚  ğŸ” å®¡è®¡è¿½æº¯      å®Œæ•´è®°å½•å†³ç­–è¿‡ç¨‹ï¼Œæ”¯æŒå¤ç°ä¸å¯¹è´¦                     â”‚
â”‚  ğŸ§® çº¦æŸæ±‚è§£      CVXPY ç”Ÿæˆæ»¡è¶³çº¦æŸçš„æœ€ä¼˜è°ƒä»“æ–¹æ¡ˆ                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ¶æ„æ¦‚è§ˆ

![Risk-masæ¡†æ¶å›¾](Risk-masæ¡†æ¶å›¾.png)

### å·¥ä½œæµç¨‹

ç³»ç»Ÿé‡‡ç”¨ DAGï¼ˆæœ‰å‘æ— ç¯å›¾ï¼‰ç¼–æ’ï¼Œå·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š

```
+--------------------------------------------------------------------------+
|                              INPUT LAYER                                 |
|                       Intent + Context (Portfolio)                       |
+------------------------------------+-------------------------------------+
                                     |
                                     v
+--------------------------------------------------------------------------+
|                           PRE-PROCESS PIPELINE                           |
|  +----------+   +--------------+   +----------+   +----------------+     |
|  | Validate | > | Data Quality | > | Snapshot | > |   Gatekeeper   |     |
|  +----------+   +--------------+   +----------+   +----------------+     |
+------------------------------------+-------------------------------------+
                                     |
                                     v
+--------------------------------------------------------------------------+
|                        SUPERVISOR (LLM Router)                           |
|         Selects nodes to run from candidates based on business logic     |
+------------------------------------+-------------------------------------+
                                     |
                                     v
+--------------------------------------------------------------------------+
|                    PARALLEL ANALYSIS (6 Nodes Concurrent)                |
|  +--------+ +---------------+ +---------------+ +-----------+            |
|  | Market | | Concentration | |Diversification| | Liquidity |            |
|  +--------+ +---------------+ +---------------+ +-----------+            |
|  +------------------------+ +--------------------------------+           |
|  |     Macro (Agent)      | |       Compliance(Agent)        |           |
|  +------------------------+ +--------------------------------+           |
+------------------------------------+-------------------------------------+
                                     |
                                     v
+--------------------------------------------------------------------------+
|                          POST-PROCESS PIPELINE                           |
|  +---------+   +-------------+   +----------+   +--------+   +-------+   |
|  | Reducer | > | Constraints | > | Decision | > | Solver | > | Audit |   |
|  +---------+   +-------------+   +----------+   +--------+   +-------+   |
+------------------------------------+-------------------------------------+
                                     |
                                     v
+--------------------------------------------------------------------------+
|                             OUTPUT LAYER                                 |
|                Decision + Recommendations + Audit Trail                  |
+--------------------------------------------------------------------------+
```

<details>
<summary><b>ğŸ“‹ å·¥ä½œæµç¨‹ä¸­æ–‡è¯´æ˜</b></summary>

| é˜¶æ®µ | è‹±æ–‡åç§° | ä¸­æ–‡è¯´æ˜ | å…³é”®èŠ‚ç‚¹ |
|:---:|:---|:---|:---|
| 1ï¸âƒ£ | INPUT LAYER | **è¾“å…¥å±‚** | äº¤æ˜“æ„å›¾ï¼ˆIntentï¼‰+ ç»„åˆä¸Šä¸‹æ–‡ï¼ˆContextï¼‰ |
| 2ï¸âƒ£ | PRE-PROCESS PIPELINE | **é¢„å¤„ç†ç®¡é“** | éªŒè¯ â†’ æ•°æ®è´¨é‡æ£€æŸ¥ â†’ æŒ‡æ ‡å¿«ç…§ â†’ é—¨æ§ç­›é€‰ |
| 3ï¸âƒ£ | SUPERVISOR | **æ™ºèƒ½è°ƒåº¦å™¨** | åŸºäºä¸šåŠ¡é€»è¾‘ä»å€™é€‰èŠ‚ç‚¹ä¸­é€‰æ‹©éœ€è¦è¿è¡Œçš„èŠ‚ç‚¹ |
| 4ï¸âƒ£ | PARALLEL ANALYSIS | **å¹¶è¡Œåˆ†æå±‚** | 6ä¸ªé£é™©åˆ†æèŠ‚ç‚¹å¹¶å‘æ‰§è¡Œï¼ˆå¸‚åœº/é›†ä¸­åº¦/åˆ†æ•£åº¦/æµåŠ¨æ€§/å®è§‚/åˆè§„ï¼‰ |
| 5ï¸âƒ£ | POST-PROCESS PIPELINE | **åå¤„ç†ç®¡é“** | æ±‡æ€» â†’ çº¦æŸè¯„ä¼° â†’ å†³ç­–å¼•æ“ â†’ çº¦æŸæ±‚è§£ â†’ å®¡è®¡æ—¥å¿— |
| 6ï¸âƒ£ | OUTPUT LAYER | **è¾“å‡ºå±‚** | å†³ç­–ç»“æœ + è°ƒä»“å»ºè®® + å®¡è®¡è¿½è¸ª |

**å…³é”®ç‰¹æ€§ï¼š**
- âœ… **é—¨æ§ï¼ˆGatekeeperï¼‰**ï¼šåŸºäºæ•°æ®å¯ç”¨æ€§ç­›é€‰å€™é€‰èŠ‚ç‚¹
- âœ… **è°ƒåº¦å™¨ï¼ˆSupervisorï¼‰**ï¼šåŸºäºä¸šåŠ¡é€»è¾‘æ™ºèƒ½é€‰æ‹©èŠ‚ç‚¹
- âœ… **å¹¶è¡Œæ‰§è¡Œ**ï¼šä½¿ç”¨ LangGraph Send API å®ç°çœŸæ­£çš„å¹¶è¡Œ
- âœ… **çº¦æŸæ±‚è§£**ï¼šrestrict å†³ç­–æ—¶è‡ªåŠ¨ç”Ÿæˆæ»¡è¶³çº¦æŸçš„è°ƒä»“æ–¹æ¡ˆ

</details>

### æ ¸å¿ƒç»„ä»¶

#### åˆ†æèŠ‚ç‚¹è¯´æ˜

| èŠ‚ç‚¹ | ç±»å‹ | åŠŸèƒ½ | å…³é”®æŒ‡æ ‡ |
|:---:|:---:|:---|:---|
| **Market** | ç¡®å®šæ€§é“¾ | å¸‚åœºé£é™©è¯„ä¼° | ç»„åˆæ³¢åŠ¨ç‡ |
| **Concentration** | ç¡®å®šæ€§é“¾ | é›†ä¸­åº¦é£é™©è¯„ä¼° | HHI æŒ‡æ•°ã€æœ€å¤§æƒé‡ |
| **Diversification** | ç¡®å®šæ€§é“¾ | åˆ†æ•£åº¦é£é™©è¯„ä¼° | æœ‰æ•ˆæŒä»“æ•°ï¼ˆ1/HHIï¼‰ |
| **Liquidity** | ç¡®å®šæ€§é“¾ | æµåŠ¨æ€§é£é™©è¯„ä¼° | ä¹°å–ä»·å·®ã€æˆäº¤é‡ |
| **Macro** | LLM Agent | å®è§‚ç»æµåˆ†æ | åˆ©ç‡ã€æ±‡ç‡ã€æ”¿ç­–æƒ…ç»ª |
| **Compliance** | LLM Agent | åˆè§„é£é™©åˆ†æ | ç¦æŠ•æ¸…å•ã€æ”¿ç­–åˆè§„ |

> âš ï¸ **Compliance èŠ‚ç‚¹çº¦æŸ**ï¼šè¦æ±‚å…ˆè°ƒç”¨æ£€ç´¢å·¥å…·å¹¶åœ¨è¾“å‡º evidence ä¸­å¼•ç”¨ `rag:doc[i]`ï¼ˆç¡¬çº¦æŸï¼‰ã€‚

#### å†³ç­–ç­‰çº§

| ç­‰çº§ | Severity | è¯´æ˜ |
|:---:|:---:|:---|
| **Pass** | 0 | æ”¾è¡Œï¼Œæ— é£é™© |
| **Warn** | 1 | é¢„è­¦ï¼Œå»ºè®®å…³æ³¨ |
| **Restrict** | 2 | é™åˆ¶ï¼Œéœ€è°ƒæ•´ |
| **Block** | 3 | é˜»æ–­ï¼Œç¦æ­¢æ‰§è¡Œ |

> ğŸ“ **æ·±å…¥é˜…è¯»**ï¼šæŸ¥çœ‹ [æ¡†æ¶å›¾è¯´æ˜_v2.md](æ¡†æ¶å›¾è¯´æ˜_v2.md) äº†è§£è¯¦ç»†çš„æ¶æ„è®¾è®¡ã€æ•°æ®æµå›¾å’Œæ¨¡å—é—´äº¤äº’è¯´æ˜ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.12+
- uvï¼ˆæ¨èï¼‰æˆ– pip

### å®‰è£…æ­¥éª¤

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd risk-mas

# ä½¿ç”¨ uv å®‰è£…ä¾èµ–ï¼ˆæ¨èï¼‰
uv sync

# æˆ–ä½¿ç”¨ pip
pip install -e .
```

### é…ç½®è¯´æ˜

é…ç½®ç»Ÿä¸€ç”± `src/config.py` è¯»å–ç¯å¢ƒå˜é‡ï¼›**å¤§éƒ¨åˆ†é…ç½®æœ‰é»˜è®¤å€¼ï¼Œå¯æŒ‰éœ€è¦†ç›–**ï¼ŒæŒ‰éœ€åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env`ï¼š

| å˜é‡å | å˜é‡è¯´æ˜ | ç¤ºä¾‹ |
|:---|:---|:---|
| `OPENAI_BASE_URL` | LLM å…¼å®¹æ¥å£åœ°å€ | `https://dashscope.aliyuncs.com/compatible-mode/v1` |
| `LLM_MODEL` | æ¨¡å‹åç§°ï¼ˆä¸å¡«åˆ™ä¸å¯ç”¨ LLMï¼‰ | `qwen3-max` |
| `OPENAI_API_KEY` | LLM API Key | `sk-*****` |
| `ENABLE_SUPERVISOR` | æ˜¯å¦å¯ç”¨ LLM è°ƒåº¦ | `1` |
| `TUSHARE_TOKEN` | Tushare Tokenï¼ˆä¸å¡«åˆ™å®è§‚èŠ‚ç‚¹ä¸è¿›å…¥å€™é€‰ï¼‰ | `your_token` |
| `CSV_DATA_DIR` | CSV æ•°æ®ç›®å½• | `cufel_practice_data` |
| `COMPLIANCE_RAG_SOURCE` | åˆè§„æ–‡æœ¬åº“ï¼ˆæ–‡ä»¶åæˆ–è·¯å¾„ï¼‰ | `csrc_2025.csv` |
| `RAG_ENGINE` | æ£€ç´¢æ¨¡å¼ | `vector` |

> å…¶ä½™å˜é‡è§ã€Œé…ç½®è¯¦è§£ â†’ ç¯å¢ƒå˜é‡ã€ã€‚

### è¿è¡Œæ–¹å¼

**é»˜è®¤è¾“å‡ºè¡¨æ ¼ï¼ˆæ¨èï¼‰ï¼š**
```bash
uv run --env-file .env -- python -u -m src.app
```

**è¾“å‡º JSONï¼š**
```bash
uv run --env-file .env -- python -u -m src.app -JSON --pretty
```

**å…³é—­ LLM è°ƒåº¦å™¨ï¼š**
```bash
ENABLE_SUPERVISOR=0 uv run --env-file .env -- python -u -m src.app
```

**è¿è¡Œæµ‹è¯•ï¼š**
```bash
uv run --env-file .env -- python -u test.py
```

> ğŸ’¡ `test.py` ä¼šæ ¹æ®äº¤æ˜“ç›®æ ‡ ETF çš„æ•°é‡è‡ªåŠ¨æ ¡å‡† `rules.yaml`

---

## ğŸ“˜ ä½¿ç”¨æŒ‡å—

### API è°ƒç”¨

```python
from risk_mas import RiskMAS

# åˆå§‹åŒ–
mas = RiskMAS(output="table")

# å®šä¹‰äº¤æ˜“æ„å›¾
intent = {
    "date": "2025-11-15",
    "mode": "target",
    "targets": {
        "159213": 0.25,
        "159959": 0.25,
        "511960": 0.20,
        "516310": 0.20,
        "561180": 0.10
    }
}

# å®šä¹‰ä¸Šä¸‹æ–‡
context = {
    "current_positions": {
        "159213": 0.20,
        "159959": 0.20,
        "511960": 0.20,
        "516310": 0.20,
        "561180": 0.20
    },
    "policy_profile": "default",
    "aum": 1000000.0
}

# æ‰§è¡Œé£æ§åˆ†æ
result = mas.run(intent=intent, context=context)
print(result)
```

### è¾“å…¥å‚æ•°

#### Intentï¼ˆäº¤æ˜“æ„å›¾ï¼‰

| å­—æ®µ | å¿…å¡« | ç±»å‹ | è¯´æ˜ |
|:---|:---:|:---:|:---|
| `date` | âœ… | string | äº¤æ˜“æ„å›¾æ—¥æœŸï¼Œæ ¼å¼ `YYYY-MM-DD` |
| `mode` | âœ… | string | `target`ï¼ˆç›®æ ‡æƒé‡ï¼‰æˆ– `delta`ï¼ˆå¢é‡è°ƒä»“ï¼‰ |
| `targets` | âœ… | dict | ç›®æ ‡/å¢é‡æƒé‡ï¼Œ`{code: weight}` |

#### Contextï¼ˆç»„åˆä¸Šä¸‹æ–‡ï¼‰

| å­—æ®µ | å¿…å¡« | ç±»å‹ | è¯´æ˜ |
|:---|:---:|:---:|:---|
| `current_positions` | âŒ | dict | å½“å‰æŒä»“ `{code: weight}` |
| `current_positions_date` | âŒ | string | å½“å‰æŒä»“æ—¥æœŸ |
| `universe` | âŒ | list | å€™é€‰ ETF æ±  |
| `policy_profile` | âŒ | string | é£é™©åå¥½ï¼š`default` / `conservative` |
| `aum` | âŒ | float | ç»„åˆ AUM |
| `account_type` / `jurisdiction` | âŒ | string | é¢„ç•™å­—æ®µï¼ˆç”¨äºå°†æ¥åˆ†è´¦æˆ·/åˆ†è¾–åŒºè§„åˆ™ï¼‰ |

#### RiskMAS æ„é€ å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|:---|:---:|:---|
| `llm` | `None` | å¯ç›´æ¥ä¼ å…¥ LLM å®ä¾‹ï¼ˆä¸ä¼ åˆ™æŒ‰ç¯å¢ƒå˜é‡åŠ è½½ï¼‰ |
| `output` | `table` | `table` æˆ– `json`ï¼Œå†³å®šè¿”å›è¡¨æ ¼è¿˜æ˜¯ JSON å­—ç¬¦ä¸² |
| `pretty` | `False` | JSON æ˜¯å¦ç¾åŒ–ï¼ˆå¸¦ç¼©è¿›/æ¢è¡Œï¼‰ |
| `use_env_llm` | `True` | æ˜¯å¦ä»ç¯å¢ƒå˜é‡è¯»å– LLM é…ç½® |

<details>
<summary>ğŸ“‹ æ•°æ®è´¨é‡å£å¾„ï¼ˆç‚¹å‡»å±•å¼€ï¼‰</summary>

| å£å¾„ | å­—æ®µ | è¯´æ˜ |
|:---|:---|:---|
| market | `missing_etf_master` / `missing_market` | ETF ä¸»è¡¨ç¼ºå¤±ã€è¡Œæƒ…ç¼ºå¤± |
| macro | `timeseries_available` | æ˜¯å¦å…·å¤‡å®è§‚æ—¶åºæ¥æºï¼ˆ`TUSHARE_TOKEN`ï¼‰ |
| macro | `text_available` | æ˜¯å¦å…·å¤‡å®è§‚æ–‡æœ¬æ¥æºï¼ˆCSVï¼‰ |
| macro | `latest_date` / `freshness_days` / `freshness_status` | æ–°é²œåº¦å£å¾„ |
| compliance | `text_available` | åˆè§„æ–‡æœ¬æ˜¯å¦å¯ç”¨ |
| positions | `freshness_days` | å½“å‰æŒä»“æ—¥æœŸæ–°é²œåº¦ |

> è‹¥å®è§‚æ–‡æœ¬æ—¥æœŸæ™šäº asof_dateï¼Œä¼šå†™å…¥ `data_gaps` ä¸º blockï¼ˆé˜²æ­¢æœªæ¥ä¿¡æ¯æ³„éœ²ï¼‰

</details>

### è¾“å‡ºç¤ºä¾‹

<details>
<summary>ğŸ“Š ç‚¹å‡»å±•å¼€å®Œæ•´è¾“å‡ºç¤ºä¾‹</summary>

```text
----------------+---------------------------------------------------------------------------------------
 KEY            | VALUE                                                                        
----------------+---------------------------------------------------------------------------------------
 decision       | restrict                                                                     
 recommendation | rebalance: ä½¿ç”¨çº¿æ€§è§„åˆ’åœ¨çº¦æŸä¸‹ä¼˜åŒ–ç›®æ ‡æƒé‡ | 159213=0.15906, 159959=0.42083, 511960=0.42011 
 llm_used       | True                                                                         
 llm_model      | qwen3-max                                                                    
 trace_id       | eadf0c3f8f9353c5                                                             
----------------+---------------------------------------------------------------------------------------

-----------------+----------+-------------------
 RISK            | SEVERITY | SUMMARY     
-----------------+----------+-------------------
 market          | 0        | ç»„åˆæ³¢åŠ¨ç‡å¤„äºç›®æ ‡èŒƒå›´ 
 concentration   | 0        | ç»„åˆé›†ä¸­åº¦åœ¨åˆç†èŒƒå›´å†… 
 diversification | 0        | åˆ†æ•£åº¦è¾ƒå¥½       
 liquidity       | 2        | æµåŠ¨æ€§è¾ƒå¼±       
 compliance      | 0        | æœªå‘ç°åˆè§„é—®é¢˜     
-----------------+----------+-------------------

---------------------------+------------------------------------------------------
 AUDIT                     | VALUE
---------------------------+------------------------------------------------------
 policy_profile            | default
 supervisor_result         | market,concentration,diversification,liquidity,compliance
 supervisor_rationale      | ç»„åˆé›†ä¸­åº¦æŒ‡æ ‡æ˜¾ç¤ºHHIä¸Šå‡ã€æœ‰æ•ˆæŒä»“æ•°ä¸‹é™ï¼Œä¸”æœ€å¤§ä¸ªè‚¡æƒé‡è¾ƒé«˜ï¼Œéœ€è¿è¡Œconcentrationå’ŒdiversificationèŠ‚ç‚¹æ·±å…¥åˆ†æï¼›weighted_advå’Œmax_adv_ratioæç¤ºæµåŠ¨æ€§é£é™©ï¼Œéœ€è¿è¡ŒliquidityèŠ‚ç‚¹ï¼›marketèŠ‚ç‚¹ç”¨äºæä¾›åŸºç¡€å¸‚åœºä¸Šä¸‹æ–‡ï¼›macroèŠ‚ç‚¹å› å®è§‚é£é™©severityä¸º0ä¸”æ— å¼‚å¸¸ä¿¡å·å¯è·³è¿‡ï¼›complianceä¸ºåˆè§„å¿…éœ€èŠ‚ç‚¹ï¼Œåº”ä¿ç•™ã€‚
 skills_used               | 3
 node_outputs              | 35
 tool_calls                | 3
 tool_errors               | 0
 compliance_blocklist_soft | none
 compliance_industry_hits  | none
---------------------------+------------------------------------------------------

--------------------------+-------------+------------+--------
 RULE_KEY                 | VALUE       | CURRENT    | STATUS 
--------------------------+-------------+------------+--------
 adv_restrict             | 7623.25713  | 5285.94543 | âš ï¸     
 adv_warn                 | 13023.33612 | 5285.94543 | âš ï¸     
 min_weighted_adv         | 7623.25713  | 5285.94543 | âš ï¸     
 blocklist                | CCC         | none       | âœ…      
 effective_n_restrict     | 1.44431     | 2.63929    | âœ…      
 effective_n_warn         | 1.66426     | 2.63929    | âœ…      
 hhi_restrict             | 0.69237     | 0.37889    | âœ…      
 hhi_warn                 | 0.60087     | 0.37889    | âœ…      
 max_hhi                  | 0.69237     | 0.37889    | âœ…      
 max_portfolio_volatility | 0.01936     | 0.00681    | âœ…      
 max_single_weight        | 0.81958     | 0.42083    | âœ…      
 max_weighted_spread_bps  | 244.75162   | 91.02152   | âœ…      
 spread_restrict          | 244.75162   | 91.02152   | âœ…      
 spread_warn              | 225.26680   | 91.02152   | âœ…      
 top_weight_restrict      | 0.81958     | 0.42083    | âœ…      
 top_weight_warn          | 0.74373     | 0.42083    | âœ…      
 volatility_restrict      | 0.01936     | 0.00681    | âœ…      
 volatility_warn          | 0.01764     | 0.00681    | âœ…      
--------------------------+-------------+------------+--------

------------+--------------+----------------------------------------+-----------------
 AGENT      | SUMMARY      | EVIDENCE                               | RECOMMENDATIONS 
------------+--------------+----------------------------------------+-----------------
 compliance | æœªå‘ç°åˆè§„é—®é¢˜ | tool:compliance_blocklist              | è¯·å¤æ ¸åˆè§„è§„åˆ™         
 macro      | æœªè¿è¡Œ        | åŸå› æ¥è‡ª supervisor_rationale           | none            
------------+--------------+----------------------------------------+-----------------
```

åˆè§„èŠ‚ç‚¹ï¼ˆJSON ç‰‡æ®µç¤ºä¾‹ï¼Œå« `rag:doc[i]` å¼•ç”¨ï¼‰ï¼š

```json
{
  "finding_compliance": {
    "severity": 1,
    "summary": "å‘½ä¸­æ–‡æœ¬æç¤ºçš„è¡Œä¸šé™åˆ¶ï¼Œå»ºè®®å¤æ ¸ç›¸å…³ETFã€‚",
    "evidence": [
      {"ref": "rag:doc[1]", "quote": "â€¦æ¶‰åŠè¡Œä¸šé™åˆ¶çš„æ¡æ¬¾â€¦"},
      {"ref": "tool:policy_search", "hits": 3}
    ],
    "recommendations": ["è¯·æ ¸å¯¹ç¦æŠ•/é™åˆ¶æ¸…å•å¹¶è°ƒæ•´ç›®æ ‡æƒé‡"]
  }
}
```

</details>

---

## âš™ï¸ é…ç½®è¯¦è§£

### asof_date å–å€¼è§„åˆ™

- `asof_date` ä¼šæ ¹æ® `intent.date` è‡ªåŠ¨æ˜ å°„ä¸º"ä¸Šä¸€ä¸ªäº¤æ˜“æ—¥"ï¼ˆåŸºäº CSV æ•°æ®ä¸­çš„äº¤æ˜“æ—¥åºåˆ—ï¼‰
- è¯¥æ—¥æœŸç”¨äºæˆªæ–­è¡Œæƒ…/å®è§‚/åˆè§„æ•°æ®ï¼Œé¿å…ä½¿ç”¨æœªæ¥æ•°æ®
- è‹¥æ‰¾ä¸åˆ°æ›´æ—©äº¤æ˜“æ—¥ï¼Œåˆ™å›é€€åˆ° `intent.date`

### ç¯å¢ƒå˜é‡

> ç¯å¢ƒå˜é‡ç”± `RuntimeConfig` ç±»ç»Ÿä¸€è¯»å–å¹¶æ³¨å…¥åˆ°å…³é”®æ¨¡å—ã€‚

#### æ•°æ®ä¸é‡‡æ ·

| å˜é‡ | é»˜è®¤å€¼ | è¯´æ˜ |
|:---|:---:|:---|
| `CSV_DATA_DIR` | `cufel_practice_data` | CSV æ•°æ®ç›®å½• |
| `SAMPLE_UNIVERSE_SIZE` | `5` | éšæœºæ ·æœ¬ ETF æ•° |
| `RANDOM_SEED` | - | éšæœºç§å­ |
| `MARKET_LOOKBACK_DAYS` | `60` | è¡Œæƒ…å›æº¯å¤©æ•° |

#### å®è§‚æ—¶åº

| å˜é‡ | é»˜è®¤å€¼ | è¯´æ˜ |
|:---|:---:|:---|
| `TUSHARE_TOKEN` | - | Tushare Tokenï¼ˆç¼ºå¤±åˆ™å®è§‚èŠ‚ç‚¹ä¸è¿›å…¥å€™é€‰ï¼‰ |
| `MACRO_SERIES_CONFIG` | `cufel_practice_data/macro_series.yaml` | å®è§‚æŒ‡æ ‡é…ç½®è·¯å¾„ |
| `MACRO_STALE_DAYS` | `30` | å®è§‚æ–‡æœ¬æ•°æ®é™ˆæ—§é˜ˆå€¼ |

#### åˆè§„æ–‡æœ¬ / RAG

| å˜é‡ | é»˜è®¤å€¼ | è¯´æ˜ |
|:---|:---:|:---|
| `COMPLIANCE_RAG_SOURCE` | - | åˆè§„æ–‡æœ¬åº“ï¼ˆæ–‡ä»¶åæˆ–å®Œæ•´è·¯å¾„ï¼‰ |
| `RAG_ENGINE` | `vector` | æ£€ç´¢æ¨¡å¼ï¼š`vector` / `keyword` |

> ğŸ’¡ `vector` æ¨¡å¼éœ€è¦ `OPENAI_API_KEY`ï¼›è‹¥æœªé…ç½® embeddingï¼Œå¯è®¾ç½® `RAG_ENGINE=keyword`

#### ç»„åˆæ‰§è¡Œä¸ LP

| å˜é‡ | é»˜è®¤å€¼ | è¯´æ˜ |
|:---|:---:|:---|
| `AUM` / `PORTFOLIO_AUM` | - | ç»„åˆ AUM |
| `TARGET_HOLDINGS` | - | è°ƒä»“å»ºè®®ç›®æ ‡æŒä»“æ•°é‡ |
| `LP_TURNOVER_WEIGHT` | `0.1` | LP ä¸­æ¢æ‰‹æƒ©ç½šæƒé‡ |
| `LP_SOLVER` | - | LP æ±‚è§£å™¨åç§°ï¼ˆå¦‚ `ECOS` / `OSQP`ï¼‰ |

### è§„åˆ™é˜ˆå€¼

#### rules.yamlï¼ˆç»„åˆè§„åˆ™é˜ˆå€¼ï¼‰

**åŸç†ï¼š**
- åœ¨å†å²çª—å£å†…éšæœºæŠ½æ ·ç»„åˆï¼šä» ETF æ± éšæœºæŠ½å– n åªï¼Œä½¿ç”¨ Dirichlet(1,...,1) ç”Ÿæˆæƒé‡
- è®¡ç®—ç»„åˆæŒ‡æ ‡å¹¶å½¢æˆç»éªŒåˆ†å¸ƒï¼ˆæ³¢åŠ¨ç‡ã€HHIã€ADVã€spread ç­‰ï¼‰
- æ³¢åŠ¨ç‡å£å¾„ï¼šä¼˜å…ˆä½¿ç”¨å¤æƒä»·è®¡ç®—æ”¶ç›Šç‡ä¸æ³¢åŠ¨ç‡
- å¯¹æŒ‡æ ‡åˆ†å¸ƒå–åˆ†ä½æ•°ç”Ÿæˆ `warn/restrict` é˜ˆå€¼

#### macro_series.yamlï¼ˆå®è§‚é˜ˆå€¼é…ç½®ï¼‰

**åŸç†ï¼š**
- æ‹‰å–å®è§‚æ—¶åºæ•°æ®ï¼Œå¹¶æŒ‰ `asof_date` æˆªæ–­
- è®¡ç®—ç›¸é‚»ä¸¤æœŸçš„å˜åŒ–å¹…åº¦
- å¯¹å˜åŒ–å¹…åº¦åˆ†å¸ƒå–åˆ†ä½æ•°ç”Ÿæˆé˜ˆå€¼

> âš ï¸ æ¯æ¬¡è¿è¡Œ `test.py`ï¼Œé˜ˆå€¼é…ç½®ä¼šæ ¹æ®ç”¨æˆ·è¾“å…¥ï¼ˆç›®æ ‡æŒä»“çš„ç§ç±»æ•°ã€äº¤æ˜“æ—¶é—´ç­‰ï¼‰**è‡ªåŠ¨æ›´æ–°**ï¼Œä¼šè¦†ç›–æ‰‹åŠ¨ä¿®æ”¹çš„å€¼ã€‚

### Skills ä½“ç³»

Skills ä½“ç³»å°†æç¤ºè¯ã€è¾“å‡ºç»“æ„ã€å·¥å…·æƒé™ã€è¯æ®è§„åˆ™åšæˆå¯é…ç½®çš„æŠ€èƒ½åŒ…ï¼š

| æŠ€èƒ½ | è¯´æ˜ | å·¥å…· |
|:---|:---|:---|
| `macro-tool-calling` | å®è§‚å·¥å…·è°ƒç”¨ä»£ç† | `macro_timeseries`, `macro_search` |
| `compliance-evidence` | åˆè§„è¯æ®ä»£ç† | `policy_search`, `allowlist_check` |
| `risk-market-assessor` | å¸‚åœºé£é™©è¯„ä¼° | æ— ï¼ˆç¡®å®šæ€§ï¼‰ |
| `liquidity-execution-assessor` | æµåŠ¨æ€§è¯„ä¼° | æ— ï¼ˆç¡®å®šæ€§ï¼‰ |
| `supervisor-router` | ç›‘ç£è·¯ç”± | æ—  |

---

## ğŸ“ é¡¹ç›®ç»“æ„

<details>
<summary>ğŸ“‚ ç‚¹å‡»å±•å¼€ç²¾ç®€ç»“æ„</summary>

```
risk-mas/
â”œâ”€â”€ src/                          # ä¸»æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ app.py                    # CLI å…¥å£
â”‚   â”œâ”€â”€ graph.py                  # LangGraph ç¼–æ’
â”‚   â”œâ”€â”€ state.py                  # æ˜¾å¼ State å®šä¹‰
â”‚   â”œâ”€â”€ config.py                 # é›†ä¸­åŒ–é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ skills_runtime.py         # Skills è¿è¡Œæ—¶
â”‚   â”œâ”€â”€ chains/                   # åˆ†æé“¾è·¯
â”‚   â”œâ”€â”€ agents/                   # LLM Agent
â”‚   â””â”€â”€ tools/                    # ç¡®å®šæ€§å·¥å…·
â”‚
â”œâ”€â”€ cufel_practice_data/          # CSV æ•°æ®æº
â”‚   â”œâ”€â”€ rules.yaml                # è§„åˆ™é˜ˆå€¼
â”‚   â””â”€â”€ *.csv                     # æ•°æ®æ–‡ä»¶
â”‚
â””â”€â”€ skills/                       # Skills é…ç½®
    â”œâ”€â”€ */SKILL.md                # æŠ€èƒ½å®šä¹‰
    â”œâ”€â”€ */output.schema.json      # è¾“å‡º Schema
    â””â”€â”€ snippets/                 # å¯å¤ç”¨ç‰‡æ®µ
```

</details>

<details>
<summary>ğŸ“‚ ç‚¹å‡»å±•å¼€è¯¦ç»†ç»“æ„</summary>

```
risk-mas/
â”œâ”€â”€ README.md                     # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ pyproject.toml                # Python ä¾èµ–é…ç½®
â”œâ”€â”€ uv.lock                       # ä¾èµ–é”å®šæ–‡ä»¶
â”‚
â”œâ”€â”€ src/                          # ä¸»æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ app.py                    # CLI å…¥å£
â”‚   â”œâ”€â”€ mas.py                    # RiskMAS é—¨é¢ç±»
â”‚   â”œâ”€â”€ graph.py                  # LangGraph ç¼–æ’
â”‚   â”œâ”€â”€ state.py                  # State å®šä¹‰
â”‚   â”œâ”€â”€ config.py                 # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ skills_runtime.py         # Skills è¿è¡Œæ—¶
â”‚   â”‚
â”‚   â”œâ”€â”€ chains/                   # åˆ†æé“¾è·¯
â”‚   â”‚   â”œâ”€â”€ common.py             # é€šç”¨å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ gatekeeper.py         # æ•°æ®å¯ç”¨æ€§æ£€æŸ¥ä¸å€™é€‰èŠ‚ç‚¹ç­›é€‰
â”‚   â”‚   â”œâ”€â”€ supervisor.py         # ä¸šåŠ¡é€»è¾‘èŠ‚ç‚¹é€‰æ‹©
â”‚   â”‚   â”œâ”€â”€ market.py             # å¸‚åœºé£é™©
â”‚   â”‚   â”œâ”€â”€ concentration.py      # é›†ä¸­åº¦é£é™©
â”‚   â”‚   â”œâ”€â”€ diversification.py    # åˆ†æ•£åº¦é£é™©
â”‚   â”‚   â”œâ”€â”€ liquidity.py          # æµåŠ¨æ€§é£é™©
â”‚   â”‚   â””â”€â”€ reducer.py            # ç»“æœèšåˆ
â”‚   â”‚
â”‚   â”œâ”€â”€ agents/                   # LLM Agent
â”‚   â”‚   â”œâ”€â”€ agent_utils.py        # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ macro_agent.py        # å®è§‚åˆ†æ
â”‚   â”‚   â””â”€â”€ compliance_agent.py   # åˆè§„åˆ†æ
â”‚   â”‚
â”‚   â””â”€â”€ tools/                    # ç¡®å®šæ€§å·¥å…·
â”‚       â”œâ”€â”€ utils.py              # å…±äº«å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ validate.py           # è¾“å…¥éªŒè¯
â”‚       â”œâ”€â”€ data_quality.py       # æ•°æ®è´¨é‡
â”‚       â”œâ”€â”€ snapshot.py           # æŒ‡æ ‡å¿«ç…§
â”‚       â”œâ”€â”€ constraints.py        # çº¦æŸè¯„ä¼°
â”‚       â”œâ”€â”€ decision.py           # å†³ç­–å¼•æ“
â”‚       â”œâ”€â”€ solver.py             # çº¦æŸæ±‚è§£
â”‚       â”œâ”€â”€ audit.py              # å®¡è®¡æ—¥å¿—
â”‚       â”œâ”€â”€ rules.py              # è§„åˆ™åŠ è½½
â”‚       â”œâ”€â”€ csv_data.py           # CSV å¤„ç†
â”‚       â”œâ”€â”€ calibrate_rules.py    # è§„åˆ™æ ¡å‡†
â”‚       â””â”€â”€ calibrate_macro_series.py  # å®è§‚æ ¡å‡†
â”‚
â”œâ”€â”€ cufel_practice_data/          # æ•°æ®æºç›®å½•
â”‚   â”œâ”€â”€ rules.yaml                # è§„åˆ™é˜ˆå€¼é…ç½®
â”‚   â”œâ”€â”€ macro_series.yaml         # å®è§‚åºåˆ—é…ç½®
â”‚   â”œâ”€â”€ etf_2025_data.csv         # ETF è¡Œæƒ…æ•°æ®
â”‚   â”œâ”€â”€ sampled_etf_basic.csv     # ETF åŸºç¡€ä¿¡æ¯
â”‚   â”œâ”€â”€ csrc_2025.csv             # åˆè§„æ–‡æœ¬åº“
â”‚   â”œâ”€â”€ govcn_2025.csv            # å®è§‚æ–‡æœ¬åº“
â”‚   â””â”€â”€ govcn_2025_results.json   # å®è§‚æƒ…ç»ªç»“æœ
â”‚
â””â”€â”€ skills/                       # Skills é…ç½®ä½“ç³»
    â”œâ”€â”€ macro-tool-calling/       # å®è§‚å·¥å…·è°ƒç”¨
    â”œâ”€â”€ compliance-evidence/      # åˆè§„è¯æ®
    â”œâ”€â”€ risk-market-assessor/     # å¸‚åœºé£é™©è¯„ä¼°
    â”œâ”€â”€ liquidity-execution-assessor/  # æµåŠ¨æ€§è¯„ä¼°
    â”œâ”€â”€ supervisor-router/        # ç›‘ç£è·¯ç”±
    â”œâ”€â”€ snippets/                 # å¯å¤ç”¨ç‰‡æ®µ
    â”œâ”€â”€ schemas/                  # é€šç”¨ Schema
    â””â”€â”€ tools/                    # å·¥å…·æ¥å£å®šä¹‰
```

</details>

---

## ğŸ”„ è¿ç§»æŒ‡å—

é€‚é…æ–°æ•°æ®æºæˆ–èµ„äº§ç±»å‹æ—¶ï¼ŒæŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

### 1. æ•°æ®æºä¸å­—æ®µå¯¹é½

- æŒ‰å­—æ®µå£å¾„å‡†å¤‡ CSV æ–‡ä»¶
- è‹¥å­—æ®µä¸ä¸€è‡´ï¼Œä¿®æ”¹ `src/tools/csv_data.py` çš„è§£æé€»è¾‘

### 2. é˜ˆå€¼ä¸æ ¡å‡†

- ç»„åˆé˜ˆå€¼ï¼š`cufel_practice_data/rules.yaml`
- å®è§‚é˜ˆå€¼ï¼š`cufel_practice_data/macro_series.yaml`

### 3. Skills ä¸å·¥å…·æƒé™

- è°ƒæ•´ `skills/*/SKILL.md` çš„ allowlist/snippets/schema
- ç¡®ä¿ `skills/tools/tool_interfaces.yaml` ä¸å®é™…å·¥å…·ä¸€è‡´

### 4. å®¡è®¡ä¸è¾“å‡º

- ä¿æŒ `audit` ç»“æ„ä¸€è‡´ï¼Œä¾¿äºå¯¹è´¦ä¸å¤ç°

---

## â“ å¸¸è§é—®é¢˜

<details>
<summary><b>Q: å¦‚ä½•å…³é—­ LLM åŠŸèƒ½ï¼Ÿ</b></summary>

ä¸è®¾ç½® `LLM_MODEL` ç¯å¢ƒå˜é‡ï¼Œæˆ–è®¾ç½® `ENABLE_SUPERVISOR=0`ã€‚

</details>

<details>
<summary><b>Q: å®è§‚åˆ†æèŠ‚ç‚¹ä¸è¿è¡Œï¼Ÿ</b></summary>

æ£€æŸ¥æ˜¯å¦è®¾ç½®äº† `TUSHARE_TOKEN`ã€‚ç¼ºå¤±æ—¶å®è§‚èŠ‚ç‚¹ä¸è¿›å…¥å€™é€‰ã€‚

</details>

<details>
<summary><b>Q: åˆè§„æ£€ç´¢å¤±è´¥ï¼Ÿ</b></summary>

1. æ£€æŸ¥ `COMPLIANCE_RAG_SOURCE` æ˜¯å¦æ­£ç¡®æŒ‡å‘åˆè§„æ–‡æœ¬åº“
2. è‹¥ embedding æœåŠ¡ä¸å¯ç”¨ï¼Œè®¾ç½® `RAG_ENGINE=keyword`

</details>

<details>
<summary><b>Q: å¦‚ä½•è‡ªå®šä¹‰é£é™©é˜ˆå€¼ï¼Ÿ</b></summary>

**æ³¨æ„**ï¼šæ¯æ¬¡è¿è¡Œ `test.py` ä¼šè‡ªåŠ¨æ›´æ–°é˜ˆå€¼é…ç½®ï¼Œè¦†ç›–æ‰‹åŠ¨ä¿®æ”¹çš„å€¼ã€‚

å¦‚éœ€æ‰‹åŠ¨æ ¡å‡†é˜ˆå€¼ï¼ˆä¸è¿è¡Œ test.py çš„æƒ…å†µä¸‹ï¼‰ï¼š

```bash
# æ ¡å‡†ç»„åˆè§„åˆ™é˜ˆå€¼
uv run --env-file .env -- python -u -m src.tools.calibrate_rules \
    --asof-date <ASOF_DATE> --n <ETFæ•°é‡>

# æ ¡å‡†å®è§‚æ—¶åºé˜ˆå€¼
uv run --env-file .env -- python -u -m src.tools.calibrate_macro_series \
    --asof-date <ASOF_DATE>
```

å…¶ä¸­ `<ASOF_DATE>` å¡«äº¤æ˜“æ„å›¾æ—¥æœŸçš„å‰ä¸€ä¸ªäº¤æ˜“æ—¥ï¼Œ`<ETFæ•°é‡>` å¡«äº¤æ˜“æ„å›¾çš„ ETF æ•°é‡ã€‚

</details>

---

<div align="center">

**Risk-MAS** - è®©é£æ§æ›´æ™ºèƒ½ã€æ›´å¯é 

</div>
